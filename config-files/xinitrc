#!/usr/bin/env bash
set -e

exec >>/home/kiosk/kiosk-session.log 2>&1

xset s off || true
xset -dpms || true
xset s noblank || true

for i in {1..30}; do
  if curl -fsS http://127.0.0.1:8080/ >/dev/null 2>&1; then
    break
  fi
  sleep 1
done

URL="http://127.0.0.1:8080/"

# Optional debug terminal if xterm is available.
if command -v xterm >/dev/null 2>&1; then
  xterm -geometry 120x40+20+20 -e 'echo "Kiosk debug terminal"; echo "Logs: /home/kiosk/kiosk-session.log"; echo "Press Ctrl+C to close"; bash' &
fi

while true; do
  dbus-run-session firefox \
    --new-instance \
    --kiosk \
    "$URL" || true
  sleep 1
done
